---
layout: post
title: "添加新浪微博api接口的总结"
date: 2013-10-15 15:00
comments: true
categories: blog
---

我的博客主要用了[新浪微博开放平台](http://open.weibo.com)提供的三种api接口：分享按钮，微博发布窗，微博秀。
[微博发布窗](http://open.weibo.com/widget/publisher.php)和[微博秀](http://app.weibo.com/tool/weiboshow)放在博客的asides里，代码由上面链接中自动提供，在`source/_include/asides/weibo.html`里加入即可。分享按钮的添加方式在[上一篇博客]({{ base_url }}/blog/2013/10/14/ru-he-tian-jia-xin-lang-wei-bo-zhuan-fa-gong-neng/)中有详细描述。

完成上述代码添加后，即可在博客界面上查看特定微博，发送微博，转发微博操作，但是这样会有一个问题，转发微博后展示页面左下方来源会显示`来自分享按钮`，发送微博后显示`来自未经审核应用`，这是因为新浪微博会为每个接入网站或者应用提供一个appkey，如果网站或者应用没有经过新浪的审核，则会有如上显示。

解决这个问题的方法就是在[新浪微博开放平台](http://open.weibo.com)中进行三步认证（手续极具中国特色，但相对来说新浪效率还是不错的），首先是填写开发者资料，各种个人信息和联系方式等，审核过了以后需要提供身份认证，主要就是上传身份证照片，提供身份证号，实名登记，哎~~，经过大致一天审核后，就可以添加自己的网站或应用了。在[添加新网站](http://open.weibo.com/webmaster/add)界面填写信息，网站名称和域名，域名一定要是网站根域名，否则会给后面带来麻烦。另外需要在自己的界面中增加如下代码来经过审核：

    <meta property="wb:webmaster" content="xxxxxx" />
<!--more-->    
完成上述步骤后，进入最后一步网站或者应用审核了，也是最麻烦的一步，由于国情的原因，除了填写网站名称，域名，介绍等基本信息，还需要提供ISP备案信息（damn it！），大部分人走到这步心里估计就放弃了，个人站点博客之类的哪儿会去备案呢，何况是VPS，虚拟云主机或者干脆是Github托管，不过新浪厚道的提供了一个选项，站点是国内还是国外的，国内的需要ISP备案，国外的话不需要备案信息，但是需要提供一个海外网站证明扫描件，开始一头雾水，不知到这个证明是什么，不过在[微博开放平台问答](http://open.weibo.com/qa)搜索下，会发现其实只要提供一个国际顶级域名注册证书即可，比如(http://www.now.cn/domain/cer.net?IDDomain=11888448)，这个证书在申请域名的提供商那里可以获得，比如我在[易名中国](http://www.ename.com)注册的域名，在域名管理页面中提供域名证书功能，直接截图上传审核即可。

审核时间大致在大半天到一天左右，效率还是不错的，通过审核后，就正式可以接入微博了，在博客页面发布微博或者转发微博都会显示来源为XXX网站（名字为审核时填写的网站名称）。

不过在放置分享按钮时出现点小问题，一直都只能显示来自分享按钮，无法显示来自xxx网站，后面提取url一点点的debug发现新浪自动生成的appkey是经过编码的，可能是因为安全或者其他考虑，没有显示appkey明文，但是编码过的appkey就会带来上述问题，必须将代码中的appkey改成明文才能带来预想效果。

最后，如果你没有强迫症或者某种装X需要:),显示`来自未审核应用`也是可接受的，也就省去了上面麻烦令人崩溃的步骤。
